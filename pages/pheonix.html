<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
    <style>
    /* This targets the video element created by AR.js */
    video {
      object-fit: contain !important; /* Forces the video to fit inside the container, preventing cropping/zooming. */
      width: 100% !important;
      height: 100% !important;
    }
    /* Ensure the scene itself fills the screen */
    #scene {
        width: 100vw;
        height: 100vh;
    }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  </head>
  <body style="margin: 0; overflow: hidden">
    <button
      id="animation-toggle-btn"
      style="
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 99;
        padding: 10px 20px;
        font-size: 16px;
        color: white;
        border: none;
        border-radius: 5px;
        background-color: black; 
        color: white;
      "
      class="bg-indigo-600 hover:bg-indigo-700"
    >
      PAUSE Animation
    </button>
    <a-scene
      
      vr-mode-ui="enabled: false;"
      loading-screen="enabled: false;"
      renderer="logarithmicDepthBuffer: true;"
      arjs="trackingMethod: best; sourceType: webcam; sourceWidth:1280; sourceHeight:720; displayWidth:1280; displayHeight:720; sourceOrientation: landscape; debugUIEnabled: false;"
      id="scene"
      embedded
      gesture-detector
    >
      <a-assets>
        <a-asset-item
          id="animated-asset"
          src="../assets/pheonix.gltf"
        ></a-asset-item>
      </a-assets>
      <a-marker
        id="animated-marker"
        type="pattern"
        preset="custom"
        url="../assets/marker.patt"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
        id="markerA"
      >
        <a-entity
          id="bowser-model"
          rotation="270 0 0"
          scale="0.0027014445359187476 0.0027014445359187476 0.0027014445359187476"
          animation-mixer="loop: repeat"
          gltf-model="#animated-asset"
          class="clickable"
          gesture-handler
        ></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
    <script>
            document.addEventListener("DOMContentLoaded", () => {
                const scene = document.querySelector("#scene");
                const animationButton = document.querySelector("#animation-toggle-btn");

                let isPaused = false;

                // Wait for the A-Frame scene to be fully loaded
                scene.addEventListener("loaded", () => {
                    console.log(
                        "A-Frame Scene is loaded. Attaching interactivity handlers."
                    );

                    // CORRECTED ID HERE: changed from #ar-model to #bowser-model
                    const model = document.querySelector("#bowser-model"); 
                    
                    if (!model) {
                         console.error("Model entity not found with ID #bowser-model!");
                         return; // Stop execution if the model isn't found
                    }

                    // REMOVED REDUNDANT SCALE AND ROTATION LOGIC FOR CLEANER CODE
                    // The model's initial scale and rotation should be set in the HTML markup.

                    // --- Animation Toggle Logic ---
                    if (animationButton) {
                        animationButton.addEventListener("click", () => {
                            isPaused = !isPaused;

                            if (isPaused) {
                                // Pause the animation
                                model.setAttribute("animation-mixer", "timeScale: 0");
                                animationButton.textContent = "PLAY Animation";
                                animationButton.classList.replace(
                                    "bg-indigo-600",
                                    "bg-green-600"
                                );
                                animationButton.classList.replace(
                                    "hover:bg-indigo-700",
                                    "hover:bg-green-700"
                                );
                            } else {
                                // Resume the animation
                                model.setAttribute("animation-mixer", "timeScale: 1");
                                animationButton.textContent = "PAUSE Animation";
                                animationButton.classList.replace(
                                    "bg-green-600",
                                    "bg-indigo-600"
                                );
                                animationButton.classList.replace(
                                    "hover:bg-green-700",
                                    "hover:bg-indigo-700"
                                );
                            }
                        });
                    } else {
                         console.error("Animation toggle button not found!");
                    }
                });
            });
        </script>
  </body>
</html>
