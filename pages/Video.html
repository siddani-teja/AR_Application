<!doctype html>
<html>
<head>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>

    <script>
        AFRAME.registerComponent('videohandler', {
            init: function () {
                const marker = this.el;
                this.vid = document.querySelector("#vid");

                marker.addEventListener('markerFound', () => {
                    this.vid.play();
                    document.getElementById("toggle").checked = true;
                });

                marker.addEventListener('markerLost', () => {
                    this.vid.pause();
                    document.getElementById("toggle").checked = false;
                });
            }
        });

        // Toggle Switch Control
        window.onload = function () {
            const toggle = document.getElementById("toggle");
            const video = document.getElementById("vid");

            toggle.addEventListener("change", function () {
                if (this.checked) {
                    video.play();
                } else {
                    video.pause();
                }
            });
        };
    </script>

    <style>
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            display: none;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4CAF50;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .label-text {
            color: white;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>

<body style="margin: 0; overflow: hidden;">

<a-scene
    vr-mode-ui="enabled: false"
    loading-screen="enabled: false"
    arjs="sourceType: webcam; debugUIEnabled: false;"
    embedded
    gesture-detector>

    <a-assets>
        <video
            id="vid"
            src="assets/video.mp4"
            preload="auto"
            loop
            crossorigin
            webkit-playsinline
            autoplay
            playsinline>
        </video>
    </a-assets>

    <a-marker
        type="pattern"
        preset="custom"
        url="assets/marker.patt"
        videohandler
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
    >
        <a-video
            src="#vid"
            scale="1 1 1"
            position="0 0.1 0"
            rotation="-90 0 0"
            gesture-handler>
        </a-video>
    </a-marker>

    <a-entity camera></a-entity>
</a-scene>

<!-- Toggle Control -->
<div class="controls">
    <label class="switch">
        <input type="checkbox" id="toggle">
        <span class="slider"></span>
    </label>
    <div class="label-text">Play / Pause</div>
</div>

</body>
</html>
